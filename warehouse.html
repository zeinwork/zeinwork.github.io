<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Warehouse Stock Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <style>
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 64px;
            height: 64px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 h-screen overflow-hidden">
    <div id="app" class="p-6 h-screen overflow-y-auto">
        <div id="loading" class="flex items-center justify-center h-screen">
            <div class="text-center">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600 text-lg">Loading warehouse data...</p>
            </div>
        </div>

        <div id="mainApp" class="max-w-7xl mx-auto hidden h-full">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-3">
                        <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                        </svg>
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800">Warehouse Stock Management</h1>
                            <p class="text-gray-500">Real-time inventory tracking and analysis</p>
                        </div>
                    </div>
                    <button onclick="showDashboard()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold">
                        Dashboard
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <button onclick="handleAllStock()" class="px-6 py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition font-semibold shadow-md">
                        All Stock
                    </button>

                    <div class="col-span-1 md:col-span-2 lg:col-span-2 grid grid-cols-1 gap-4">
                        <input type="text" id="searchInput" placeholder="Enter SKU or search term..." class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="handleSearchAvailableSKU()" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 transition text-sm font-semibold">
                                Search Available SKU
                            </button>
                            <button onclick="handleSearchAnySKU()" class="px-4 py-2 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-lg hover:from-pink-600 hover:to-pink-700 transition text-sm font-semibold">
                                Search Any SKU
                            </button>
                        </div>
                    </div>

                    <div class="col-span-1 md:col-span-2 lg:col-span-3 grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button onclick="handleSearchAvailableSpecs()" class="px-6 py-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition font-semibold shadow-md">
                            Search Available Specs
                        </button>
                        <button onclick="handleSearchAnySpecs()" class="px-6 py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition font-semibold shadow-md">
                            Search Any Specs
                        </button>
                    </div>
                </div>
            </div>

            <div id="dashboardView" class="h-full flex flex-col">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-4 flex-shrink-0">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-semibold uppercase">Total Items</p>
                                <p id="totalItems" class="text-3xl font-bold text-blue-600 mt-2">0</p>
                            </div>
                            <svg class="w-12 h-12 text-blue-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                            </svg>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-semibold uppercase">Unique SKUs</p>
                                <p id="uniqueSKUs" class="text-3xl font-bold text-purple-600 mt-2">0</p>
                            </div>
                            <svg class="w-12 h-12 text-purple-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-semibold uppercase">Avg per SKU</p>
                                <p id="avgPerSKU" class="text-3xl font-bold text-green-600 mt-2">0</p>
                            </div>
                            <svg class="w-12 h-12 text-green-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 flex-1 min-h-0">
                    <div class="bg-white rounded-lg shadow-lg p-6 h-full flex flex-col">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex-shrink-0">Top 5 Products by Quantity</h2>
                        <div class="flex-1 min-h-0">
                            <canvas id="pieChartTop5"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-6 h-full flex flex-col">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex-shrink-0">Stock Distribution (Top 6 SKUs)</h2>
                        <div class="flex-1 min-h-0">
                            <canvas id="pieChartTop6"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="resultsView" class="bg-white rounded-lg shadow-lg p-6 hidden h-full overflow-y-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Search Results</h2>
                <div id="resultsContent"></div>
            </div>
        </div>
    </div>

    <script>
        // CSV source URLs (unchanged)
        const STOCK_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1t9FrsG2j-y8irIc4wrrzaaEdIFrpTjUD_Su_6eZ3Iks/gviz/tq?tqx=out:csv&sheet=STOCK';
        const SPECS_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1yE-KavvXFdg3MZqiB8RjpKLiERmqpZvp8-6_Oj9QUXw/export?format=csv&gid=0';

        let stockData = [];
        let specsData = {};
        let pieChartTop5 = null;
        let pieChartTop6 = null;

        // Robust CSV parser: preserves quoted fields and leading zeros, returns array of rows (each row is array of fields)
        function parseCSV(text) {
            const lines = text.split(/\r?\n/);
            const rows = [];
            for (let rawLine of lines) {
                // skip empty lines
                if (!rawLine || !rawLine.trim()) continue;
                const row = [];
                let cur = '';
                let inQuotes = false;
                // handle BOM on first line
                if (row.length === 0) rawLine = rawLine.replace(/^\uFEFF/, '');
                for (let i = 0; i < rawLine.length; i++) {
                    const ch = rawLine[i];
                    if (ch === '"') {
                        // handle escaped double quotes inside quoted fields ("")
                        if (inQuotes && rawLine[i + 1] === '"') {
                            cur += '"';
                            i++;
                        } else {
                            inQuotes = !inQuotes;
                        }
                    } else if (ch === ',' && !inQuotes) {
                        row.push(cur);
                        cur = '';
                    } else {
                        cur += ch;
                    }
                }
                row.push(cur);
                // preserve raw string (do NOT coerce to number) and trim only outer whitespace
                rows.push(row.map(cell => (cell === null || cell === undefined) ? '' : String(cell).trim()));
            }
            return rows;
        }

        function normalizeSKU(sku) {
            if (sku === null || sku === undefined) return '';
            return String(sku).replace(/\uFEFF/g, '').trim();
        }

        window.addEventListener('DOMContentLoaded', () => {
            loadData();

            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handleSearchAvailableSpecs();
                    }
                });
            }
        });

        async function loadData() {
            try {
                // STOCK
                const stockResponse = await fetch(STOCK_SHEET_URL);
                const stockText = await stockResponse.text();
                const stockRows = parseCSV(stockText);
                // expect header in first row; skip it when building data
                stockData = stockRows.slice(1).map(cols => {
                    const sku = normalizeSKU(cols[0] || '');
                    const location = cols[1] ? String(cols[1]) : '';
                    return { sku, location };
                }).filter(r => r.sku !== '');

                // SPECS
                const specsResponse = await fetch(SPECS_SHEET_URL);
                const specsText = await specsResponse.text();
                const specsRows = parseCSV(specsText);
                specsData = {};
                // skip header row; join remaining columns as description (preserves commas inside quotes)
                specsRows.slice(1).forEach(cols => {
                    const rawSku = normalizeSKU(cols[0] || '');
                    if (!rawSku) return;
                    const description = cols.slice(1).filter(c => c !== undefined && c !== null).join(', ').trim();
                    specsData[rawSku] = description || 'No description';
                });

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');

                updateDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = '<div class="text-center"><p class="text-red-600 text-lg">Error loading data. Please check the Google Sheets URLs.</p></div>';
            }
        }

        function aggregateStock() {
            const counts = {};
            stockData.forEach(item => {
                const key = normalizeSKU(item.sku);
                if (!key) return;
                counts[key] = (counts[key] || 0) + 1;
            });
            return counts;
        }

        function updateDashboard() {
            const stockCounts = aggregateStock();
            const totalItems = stockData.length;
            const uniqueSKUs = Object.keys(stockCounts).length;
            const avgPerSKU = uniqueSKUs > 0 ? Math.round(totalItems / uniqueSKUs) : 0;

            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('uniqueSKUs').textContent = uniqueSKUs;
            document.getElementById('avgPerSKU').textContent = avgPerSKU;

            updateCharts(stockCounts);
        }

        function updateCharts(stockCounts) {
            // Top 5 by quantity for pieChartTop5
            const topFive = Object.entries(stockCounts)
                .map(([sku, quantity]) => ({ sku, quantity }))
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5);

            const labels5 = topFive.map(p => {
                const desc = specsData[p.sku];
                return desc ? `${p.sku} — ${desc.substring(0, 20)}` : p.sku;
            });
            const data5 = topFive.map(p => p.quantity);

            const ctx5 = document.getElementById('pieChartTop5').getContext('2d');
            if (pieChartTop5) pieChartTop5.destroy();
            pieChartTop5 = new Chart(ctx5, {
                type: 'pie',
                data: {
                    labels: labels5,
                    datasets: [{
                        data: data5,
                        backgroundColor: [
                            '#3b82f6', '#8b5cf6', '#ec4899',
                            '#f59e0b', '#10b981'
                        ],
                        hoverOffset: 20,
                        hoverBorderWidth: 3,
                        hoverBorderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            display: false
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            titleFont: {
                                size: 18,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 14,
                                lineHeight: 1.5
                            },
                            padding: 20,
                            cornerRadius: 12,
                            displayColors: true,
                            maxWidth: 600,
                            bodySpacing: 10,
                            callbacks: {
                                title: (context) => {
                                    const label = context[0].label;
                                    const sku = label.split(' — ')[0];
                                    return `SKU: ${sku}`;
                                },
                                label: (context) => {
                                    const label = context.label;
                                    const parts = label.split(' — ');
                                    const sku = parts[0];
                                    const specs = parts[1] || 'No description available';
                                    const quantity = context.parsed;
                                    
                                    // Split long specs into multiple lines
                                    const maxLineLength = 70;
                                    const specsLines = [];
                                    let currentLine = '';
                                    
                                    if (specs && specs !== 'No description available') {
                                        const words = specs.split(' ');
                                        words.forEach(word => {
                                            if ((currentLine + word).length <= maxLineLength) {
                                                currentLine += (currentLine ? ' ' : '') + word;
                                            } else {
                                                if (currentLine) specsLines.push(currentLine);
                                                currentLine = word;
                                            }
                                        });
                                        if (currentLine) specsLines.push(currentLine);
                                    } else {
                                        specsLines.push(specs);
                                    }
                                    
                                    return [
                                        `Quantity: ${quantity}`,
                                        `Specs:`,
                                        ...specsLines.map(line => `  ${line}`)
                                    ];
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14,
                                family: 'Arial, sans-serif'
                            },
                            textStrokeColor: '#000',
                            textStrokeWidth: 2,
                            shadowBlur: 4,
                            shadowColor: 'rgba(0, 0, 0, 0.5)',
                            shadowOffsetX: 1,
                            shadowOffsetY: 1,
                            formatter: (value, context) => {
                                const label = context.chart.data.labels[context.dataIndex];
                                const sku = label.split(' — ')[0]; // Extract SKU from label
                                return sku;
                            }
                        }
                    },
                    onHover: (event, activeElements) => {
                        event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 800,
                        easing: 'easeInOutQuart'
                    }
                },
                plugins: [ChartDataLabels]
            });

            // Top 6 for pieChartTop6
            const topSix = Object.entries(stockCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6);

            const labels6 = topSix.map(([sku]) => {
                const desc = specsData[sku];
                return desc ? `${sku} — ${desc.substring(0, 20)}` : sku;
            });
            const data6 = topSix.map(([, qty]) => qty);

            const ctx6 = document.getElementById('pieChartTop6').getContext('2d');
            if (pieChartTop6) pieChartTop6.destroy();
            pieChartTop6 = new Chart(ctx6, {
                type: 'pie',
                data: {
                    labels: labels6,
                    datasets: [{
                        data: data6,
                        backgroundColor: [
                            '#3b82f6', '#8b5cf6', '#ec4899',
                            '#f59e0b', '#10b981', '#6366f1'
                        ],
                        hoverOffset: 20,
                        hoverBorderWidth: 3,
                        hoverBorderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            display: false
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            titleFont: {
                                size: 18,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 14,
                                lineHeight: 1.5
                            },
                            padding: 20,
                            cornerRadius: 12,
                            displayColors: true,
                            maxWidth: 600,
                            bodySpacing: 10,
                            callbacks: {
                                title: (context) => {
                                    const label = context[0].label;
                                    const sku = label.split(' — ')[0];
                                    return `SKU: ${sku}`;
                                },
                                label: (context) => {
                                    const label = context.label;
                                    const parts = label.split(' — ');
                                    const sku = parts[0];
                                    const specs = parts[1] || 'No description available';
                                    const quantity = context.parsed;
                                    
                                    // Split long specs into multiple lines
                                    const maxLineLength = 70;
                                    const specsLines = [];
                                    let currentLine = '';
                                    
                                    if (specs && specs !== 'No description available') {
                                        const words = specs.split(' ');
                                        words.forEach(word => {
                                            if ((currentLine + word).length <= maxLineLength) {
                                                currentLine += (currentLine ? ' ' : '') + word;
                                            } else {
                                                if (currentLine) specsLines.push(currentLine);
                                                currentLine = word;
                                            }
                                        });
                                        if (currentLine) specsLines.push(currentLine);
                                    } else {
                                        specsLines.push(specs);
                                    }
                                    
                                    return [
                                        `Quantity: ${quantity}`,
                                        `Specs:`,
                                        ...specsLines.map(line => `  ${line}`)
                                    ];
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14,
                                family: 'Arial, sans-serif'
                            },
                            textStrokeColor: '#000',
                            textStrokeWidth: 2,
                            shadowBlur: 4,
                            shadowColor: 'rgba(0, 0, 0, 0.5)',
                            shadowOffsetX: 1,
                            shadowOffsetY: 1,
                            formatter: (value, context) => {
                                const label = context.chart.data.labels[context.dataIndex];
                                const sku = label.split(' — ')[0]; // Extract SKU from label
                                return sku;
                            }
                        }
                    },
                    onHover: (event, activeElements) => {
                        event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 800,
                        easing: 'easeInOutQuart'
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        function showDashboard() {
            document.getElementById('dashboardView').classList.remove('hidden');
            document.getElementById('resultsView').classList.add('hidden');
            // reload to ensure fresh counts (you can remove this reload if not desired)
            loadData();
        }

        function showResults(results, hasQuantity) {
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('resultsView').classList.remove('hidden');

            const resultsContent = document.getElementById('resultsContent');

            if (!results || results.length === 0) {
                resultsContent.innerHTML = '<div class="text-center py-12"><svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><p class="text-gray-500 text-lg">No results found</p></div>';
                return;
            }

            let tableHTML = '<div class="overflow-x-auto"><table class="w-full"><thead class="bg-gradient-to-r from-blue-500 to-blue-600 text-white"><tr><th class="px-6 py-3 text-left text-sm font-semibold uppercase">SKU</th><th class="px-6 py-3 text-left text-sm font-semibold uppercase">Specs Description</th>';
            
            if (hasQuantity) {
                tableHTML += '<th class="px-6 py-3 text-left text-sm font-semibold uppercase">Quantity</th>';
            }
            
            tableHTML += '</tr></thead><tbody class="divide-y divide-gray-200">';

            results.forEach(item => {
                const safeSKU = normalizeSKU(item.sku);
                const safeSpecs = (item.specs === undefined || item.specs === null) ? 'No description' : String(item.specs);
                tableHTML += '<tr class="hover:bg-blue-50 transition"><td class="px-6 py-4 text-sm font-semibold text-gray-800">' + escapeHtml(safeSKU) + '</td><td class="px-6 py-4 text-sm text-gray-600">' + escapeHtml(safeSpecs) + '</td>';
                
                if (hasQuantity) {
                    tableHTML += '<td class="px-6 py-4 text-sm"><span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full font-semibold">' + (item.quantity || 0) + '</span></td>';
                }
                
                tableHTML += '</tr>';
            });

            tableHTML += '</tbody></table></div>';
            resultsContent.innerHTML = tableHTML;
        }

        // small HTML escape helper (prevents accidental HTML injection from CSV)
        function escapeHtml(unsafe) {
            return String(unsafe)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Button handlers

        function handleAllStock() {
            const stockCounts = aggregateStock();
            const results = Object.entries(stockCounts)
                .map(([sku, quantity]) => ({
                    sku,
                    specs: specsData[sku] || 'No description',
                    quantity
                }))
                .sort((a, b) => b.quantity - a.quantity);
            
            showResults(results, true);
        }

        function handleSearchAvailableSKU() {
            const searchTerm = normalizeSKU(document.getElementById('searchInput').value);
            if (!searchTerm) return;
            
            const stockCounts = aggregateStock();
            const searchLower = searchTerm.toLowerCase();
            
            // Find SKUs that contain the search term (case-insensitive partial match)
            const results = Object.entries(stockCounts)
                .filter(([sku]) => sku.toLowerCase().includes(searchLower))
                .map(([sku, quantity]) => ({
                    sku,
                    specs: specsData[sku] || 'No description',
                    quantity
                }))
                .sort((a, b) => b.quantity - a.quantity);
            
            showResults(results, true);
        }

        function handleSearchAnySKU() {
            const searchTerm = normalizeSKU(document.getElementById('searchInput').value);
            if (!searchTerm) return;

            const searchLower = searchTerm.toLowerCase();
            
            // Find all SKUs that contain the search term (case-insensitive partial match)
            const results = Object.keys(specsData)
                .filter(sku => sku.toLowerCase().includes(searchLower))
                .map(sku => ({
                    sku,
                    specs: specsData[sku] || 'No description'
                }))
                .sort((a, b) => a.sku.localeCompare(b.sku));
            
            showResults(results, false);
        }

        function handleSearchAvailableSpecs() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) return;
            
            const searchLower = searchTerm.toLowerCase();
            const stockCounts = aggregateStock();
            
            const results = Object.entries(specsData)
                .filter(([sku, specs]) => {
                    // Search in both SKU and specs (case-insensitive)
                    const skuMatch = sku.toLowerCase().includes(searchLower);
                    const specsMatch = (specs || '').toLowerCase().includes(searchLower);
                    return skuMatch || specsMatch;
                })
                .map(([sku, specs]) => ({
                    sku,
                    specs,
                    quantity: stockCounts[sku] || 0
                }))
                .filter(item => item.quantity > 0)
                .sort((a, b) => b.quantity - a.quantity);
            
            showResults(results, true);
        }

        function handleSearchAnySpecs() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) return;
            
            const searchLower = searchTerm.toLowerCase();
            
            const results = Object.entries(specsData)
                .filter(([sku, specs]) => {
                    // Search in both SKU and specs (case-insensitive)
                    const skuMatch = sku.toLowerCase().includes(searchLower);
                    const specsMatch = (specs || '').toLowerCase().includes(searchLower);
                    return skuMatch || specsMatch;
                })
                .map(([sku, specs]) => ({
                    sku,
                    specs
                }))
                .sort((a, b) => a.sku.localeCompare(b.sku));
            
            showResults(results, false);
        }
    </script>
</body>
</html>
